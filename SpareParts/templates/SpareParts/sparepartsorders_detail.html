{% extends "base.html" %}


{% block css %}

<style>
    .sel .select2-selection__rendered {
        line-height: 31px !important;
        height: 37px !important;
    }
    .sel .select2-container .select2-selection--single {
        height: 37px !important;
        border: 1px solid lightgray;
    }
    .sel .select2-selection__arrow {
        height: 37px !important;
    }
</style>
{% endblock css %}
    

{% block main %}
{% load  crispy_forms_tags %}
    <div class="main-content">

      <div class="page-content">
          <div class="container-fluid">
           
                <div class="row">
                    <div class="col-12"> {% if messages %}
                        {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show text-center" role="alert">
                            <i class="mdi mdi-check-all mr-2"></i>
                            {{ message|safe }}
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                        {% endfor %}

            
                      {% endif %}
                    </div>
                   
                </div>
              
                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box d-flex align-items-center justify-content-between">
                            
                            {% if type == "list" %}
                                <h3 class="mb-0 "> فاتورة طلب {{order.order_number}}</h3>
                                
                                {% else %}
                                <h3 class="mb-0 ">سلة مهملات طلبات قطع الغيار</h3>
                            
                            {% endif %}
                             
                            
                                <!-- <span class="badge badge-dark font-size-15"> الاجمالي : {{count}} قطع </span> -->
                               

                           
                            <div class="page-title-right">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item"><a href="/">الرئيسية</a></li>
                                    {% if order.deleted == 0 %}
                                    <li class="breadcrumb-item"><a href="{% url 'SpareParts:SparePartsOrderList' %}">قائمة الطلبيات</a></li>
                                    {% else %}
                                    <li class="breadcrumb-item"><a href="{% url 'SpareParts:SparePartsOrderTrachList' %}">قائمة الطلبيات</a></li>
                                    {% endif %}

                                    {% if type == "list" %}
                                    <li class="breadcrumb-item active">فاتورة طلب {{order.order_number}}</li>
                                    {% else %}
                                    <li class="breadcrumb-item active">سلة مهملات طلبات قطع الغيار</li>
                                    {% endif %}
                                </ol>
                            </div>

                            

                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- معلومات الطلب -->
                    <div class="col-lg-4 col-md-4">
                        <div class="card">

                            <div class="card-body ">
                                <div class="bg-soft-danger">
                                                        <div class="row">
                                                            <div class="col-lg-12">
                                                                <div class=" p-3">
                                                                    
                                                                        <h3 class="text-center font-weight-bold" >معلومات الطلب</h3>
                                                                </div>
                                                            </div>
                                                        
                                                        </div>
                                                    </div>
                                                    <div class="table-responsive">
                                                        <table class="table table-nowrap mb-0">
                                                            <tbody>
                                                                <tr>
                                                                    <th scope="row"><i class='bx bx-bookmark-minus bx-sm' style='color:#c658c2'  ></i> رقم الطلب :</th>
                                                                    <td>{{ order.order_number }}</td>
                                                                </tr>
                                                                <tr>
                                                                    <th scope="row"> <i class='bx bx-calendar bx-sm' style='color:#c855c4'  ></i>تاريخ الطلب : </th>
                                                                    <td>{{ order.order_date|date:'Y-m-d' }}</td>
                                                                </tr>
                                                                <tr>
                                                                    <th scope="row"><i class='bx bx-user-pin bx-sm' style='color:#c658c2' ></i>المورد : </th>
                                                                    <td>{{ order.order_supplier }}</td>
                                                                </tr>
                                                                <tr>
                                                                    <th scope="row"> <i class='bx bx-dollar-circle bx-sm' style='color:#c658c2' ></i>قيمة العربون : </th>
                                                                    <td><span class="badge badge-danger font-size-14">{{ order.order_deposit_value }} جنية</span></td>
                                                                </tr>
                                                                <tr>
                                                                    <th scope="row"> <i class='bx bx-calendar bx-sm' style='color:#c855c4'  ></i>تاريخ دفع العربون :</th>
                                                                    <td > <span class="badge badge-danger font-size-14">{{ order.order_deposit_date|date:'Y-m-d' }}</span></td>
                                                                </tr>
                                                                <tr>
                                                                    <th scope="row"><i class='bx bx-calendar bx-sm' style='color:#c855c4'  ></i> تاريخ دفع باقي المبلغ :</th>
                                                                    <td>{{ order.order_rest_date|date:'Y-m-d' }}</td>
                                                                </tr>
                                                                <tr>
                                                                    <th scope="row"> <i class='bx bx-calendar bx-sm' style='color:#c855c4'  ></i>تاريخ استلام البضاعة  :</th>
                                                                    <td>{{ order.order_receipt_date|date:'Y-m-d' }}</td>

                                                                </tr>


                                                            </tbody>
                                                        </table>

                                                    </div>

                            </div>
                        </div>
                            
                        {% if order.deleted == 0 %}
                       <div class="card">
                                    <div class="card-body">
                                        
                                        
                                            <div class="row bg-soft-info">
                                                <div class="col-lg-12">
                                                    
                                                    <div class="text-primary p-3">
                                                            
                                                        <h3 class="text-center font-weight-bold" >عمليات الطلب</h3>
                                                </div>                                                </div>
                                            </div>
                                            

                                       
                                        <div data-simplebar="init" class="mt-2" style="max-height: 400px;"><div class="simplebar-wrapper" style="margin: 0px;"><div class="simplebar-height-auto-observer-wrapper"><div class="simplebar-height-auto-observer"></div></div><div class="simplebar-mask"><div class="simplebar-offset" style="right: -16.8px; bottom: 0px;"><div class="simplebar-content-wrapper" style="height: auto; overflow: hidden scroll;"><div class="simplebar-content" style="padding: 0px;">
                                            <ul class="verti-timeline list-unstyled">
                                                 
                                               
                                                {% if order.order_deposit_date %}
                                                   
                                                    {% if op1 %}
                                                             <!-- عملية دفع العربون -->
                                                             <li class="event-list active ">
                                                                <div class="event-timeline-dot">
                                                                    <i class='bx bx-dollar-circle bx-sm ' ></i>
                                                                </div>
                                                                <div class="media">
                                                                
                                                                    <div class="media-body">
                                                                        <div>

                                                                            <small class="badge badge-danger"><i class='bx bxs-calendar color-danger' ></i>
                                                                            <span> {{ order.order_deposit_date|date:'Y-m-d' }}</span>
                                                                            </small>
                                                                            
                                                                            
                                                                                
                                                                            
                                                                            <h4 class="font-weight-bold" style="text-decoration:line-through"><i class="fas fa-comment-dollar"></i> دفع العربون المستحق </h4>   

                                                                            <span href="#" style="width:40%" class="btn btn-sm btn-success">
                                                                                <i class="fas fa-check-double"></i>
                                                                                 تمت العملية بنجاح
                                                                            </span>
                                                                            
                                                                            <span class="btn btn-sm btn-info">
                                                                                {% if op1 %}
                                                                                {% for x in op1 %}
                                                                                القيمة : {{x.operation_value}}  <i class="fas fa-comment-dollar"></i>
                                                                                {% endfor %}
                                                                                {% endif %}
                                                                            </span>
                                                                        </div>
                                                                    </div>   
                                                                </div>
                                                            </li>
                                                        {% else %}
                                                             <!-- عملية دفع العربون -->
                                                             <li class="event-list active">
                                                                <div class="event-timeline-dot">
                                                                    <i class='bx bx-dollar-circle bx-sm bx-fade-left' ></i>
                                                                </div>
                                                                <div class="media">
                                                                
                                                                    <div class="media-body">
                                                                        <div>

                                                                            <small class="badge badge-danger"><i class='bx bxs-calendar color-danger' ></i>
                                                                            <span> {{ order.order_deposit_date|date:'Y-m-d' }}</span>
                                                                            </small>
                                                                            <h4 class="font-weight-bold"><i class="fas fa-comment-dollar"></i> دفع العربون المستحق </h4>   

                                                                            {% if product %}
                                                                                <a 
                                                                                href="{% url 'SpareParts:SparePartsOperationCreateDeposit' order.id %}" data-target="#action_modal" data-toggle="modal" 
                                                                                style="width:40%" class="btn btn-sm btn-primary">
                                                                                    <i class='bx bx-check-circle'></i>
                                                                                    اتمام العملية
                                                                                </a>
                                                                            {% else %}
                                                                            <span 
                                                                            style="width:40%" class="btn btn-sm btn-primary">
                                                                                <i class='bx bx-check-circle'></i>
                                                                                اتمام العملية
                                                                            </span>
                                                                            {% endif %}    
                                                                        </div>
                                                                    </div>   
                                                                </div>
                                                            </li>
                            
                                                    {% endif %}
                                                        
                                                

                                                {% endif %}
                                                    
                                                
                                                {% if order.order_rest_date %}

                                                
                                                {% if op2 %}
                                                        <!-- عملية باقي المبلغ -->
                                                <li class="event-list active">
                                                    <div class="event-timeline-dot">
                                                        <i class='bx bx-dollar-circle bx-sm ' ></i>
                                                    </div>
                                                    <div class="media">
                                                       
                                                        <div class="media-body">
                                                            <div>

                                                                <small class="badge badge-danger"><i class='bx bxs-calendar color-danger' ></i>
                                                                   <span> {{ order.order_rest_date|date:'Y-m-d' }}</span>
                                                                </small>
                                                                 <h4 class="font-weight-bold" style="text-decoration:line-through"> <i class="fas fa-file-invoice-dollar"></i> دفع باقي المبلغ المستحق </h4>   

                                                                 <span  style="width:40%" class="btn btn-sm btn-success">
                                                                    <i class="fas fa-check-double"></i>
                                                                     تمت العملية بنجاح
                                                                    </span>
                                                                    <span class="btn btn-sm btn-info">
                                                                        {% if op2 %}
                                                                        {% for x in op2 %}
                                                                        القيمة : {{x.operation_value}}  <i class="fas fa-comment-dollar"></i>
                                                                        {% endfor %}
                                                                        {% endif %}
                                                                    </span>   
                                                            </div>
                                                        </div>   
                                                    </div>
                                                </li>

                                                {% else %}
                                                        <!-- عملية باقي المبلغ -->
                                                <li class="event-list active">
                                                    <div class="event-timeline-dot">
                                                        
                                                        {% if op1 %}
                                                        <i class='bx bx-dollar-circle bx-sm bx-fade-left' ></i>
                                                        {% else %}
                                                        <i class='bx bx-dollar-circle bx-sm ' ></i>
                                                        {% endif %}
                                                            
                                                        
                                                    </div>
                                                    <div class="media">
                                                       
                                                        <div class="media-body">
                                                            <div>

                                                                <small class="badge badge-danger"><i class='bx bxs-calendar color-danger' ></i>
                                                                   <span> {{ order.order_rest_date|date:'Y-m-d' }}</span>
                                                                </small>
                                                                 <h4 class="font-weight-bold"> <i class="fas fa-file-invoice-dollar"></i> دفع باقي المبلغ المستحق </h4>   
                                                                 {% if op1 %}
                                                                   <a
                                                                   href="{% url 'SpareParts:SparePartsOperationCreateReset' order.id %}"
                                                                   style="width:40%" data-target="#action_modal" data-toggle="modal" class="btn btn-sm btn-primary"
                                                                   >
                                                                    <i class='bx bx-check-circle'></i>
                                                                       اتمام العملية
                                                                 
                                                                    </a>
                                                                {% else %}
                                                                <span
                                                                   
                                                                   style="width:40%"  class="btn btn-sm btn-primary"
                                                                   >
                                                                    <i class='bx bx-check-circle'></i>
                                                                       اتمام العملية
                                                                 
                                                                    </span>   
                                                                 {% endif %}  
                                                            </div>
                                                        </div>   
                                                    </div>
                                                </li>

                                                {% endif %}
                                                    
                                                
                                                {% endif %}
                                                    
                                                
                                               
                                               {% if order.order_receipt_date %}
                                                    <!-- عملية استلام البضاعة المبلغ -->
                                                    
                                                    {% if op3 %}
                                                    <li class="event-list active">
                                                        <div class="event-timeline-dot">
                                                            <i class='bx bx-package bx-sm ' ></i>
                                                        </div>
                                                        <div class="media">
                                                           
                                                            <div class="media-body">
                                                                <div>
    
                                                                    <small class="badge badge-danger"><i class='bx bxs-calendar color-danger' ></i>
                                                                       <span> {{ order.order_receipt_date|date:'Y-m-d' }}</span>
                                                                    </small>
                                                                     <h4 class="font-weight-bold" style="text-decoration:line-through"> <i class="fas fa-shipping-fast"></i>إستلام البضاعة </h4>   
                                                                        
                                                                     <a href="" style="width:40%" class="btn btn-sm btn-success">
                                                                        <i class="fas fa-check-double"></i>
                                                                         تمت العملية بنجاح
                                                                        </a>
                                                                </div>
                                                            </div>   
                                                        </div>
                                                    </li>
                                                    {% else %}
                                                    <li class="event-list active">
                                                        <div class="event-timeline-dot">
                                                            
                                                            
                                                            {% if op2 %}
                                                            <i class='bx bx-package bx-sm  bx-fade-left' ></i>
                                                            {% else %}
                                                            <i class='bx bx-package bx-sm  ' ></i>
                                                            {% endif %}
                                                                
                                                           
                                                        </div>
                                                        <div class="media">
                                                           
                                                            <div class="media-body">
                                                                <div>
    
                                                                    <small class="badge badge-danger"><i class='bx bxs-calendar color-danger' ></i>
                                                                       <span> {{ order.order_receipt_date|date:'Y-m-d' }}</span>
                                                                    </small>
                                                                     <h4 class="font-weight-bold"> <i class="fas fa-shipping-fast"></i>إستلام البضاعة </h4>   
                                                                        
                                                                      {% if op2 %}
                                                                       <a
                                                                    
                                                                       href="{% url 'SpareParts:SparePartsOperationCreateOrder' order.id %}"
                                                                       style="width:40%" data-target="#action_modal" data-toggle="modal" class="btn btn-sm btn-primary">
                                                                       <i class='bx bx-check-circle'></i>
                                                                          اتمام العملية
                                                                       </a>

                                                                       {% else %}
                                                                       <span
                                                                      
                                                                       
                                                                       style="width:40%" class="btn btn-sm btn-primary">
                                                                       <i class='bx bx-check-circle'></i>
                                                                          اتمام العملية
                                                                       </span>
                                                                       {% endif %}
                                                                      
                                                                            
                                                                      
                                                                </div>
                                                            </div>   
                                                        </div>
                                                    </li>
                                                    {% endif %}
                                                        
                                                

                                               {% endif %}
                                                   
                                               

                                            </ul>
                                        </div></div></div></div><div class="simplebar-placeholder" style="width: auto; height: auto;"></div></div><div class="simplebar-track simplebar-horizontal" style="visibility: hidden;"><div class="simplebar-scrollbar" style="transform: translate3d(0px, 0px, 0px); display: none;"></div></div><div class="simplebar-track simplebar-vertical" style="visibility: visible;"><div class="simplebar-scrollbar" style="height: 275px; transform: translate3d(0px, 0px, 0px); display: block;"></div></div></div>

                                    </div>
                                </div>
                        {% endif %}
                    </div>

                    {% if order.deleted == 0 %}
                    <div class="col-lg-8">

                         <div class="card">
                            <div class="card-body">

                                <div class="tab-pane" id="processing" role="tabpanel">
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="bg-soft-primary">
                                                    <div class="row">
                                                        <div class="col-lg-12">
                                                            <div class="text-primary p-3">
                                                                
                                                                    <h3 class="text-center font-weight-bold" >أصناف الطلب</h3>
                                                            </div>
                                                        </div>
                                                       
                                                    </div>
                                                </div>

                                                    <div class="table-responsive" id="order_list">
                                                        <table class="table table-nowrap mb-0">
                                                            <thead>
                                                                <form method="post" action="{{action_url}}">
                                                                {% csrf_token %}
                                                                <tr>
                                                                    <th class="col-lg-1">
                                                                    <span style="width: 100%" role="button" class="btn btn-light">م</span>

                                                                    </th>
                                                                    <th class="col-lg-5 col-xl-5 col-md-5" style="width: 100%;">
                                                                            
                                                                            <div class=" d-inline-block sel" style="width: 75%;">
                                                                                {{form.product_name|as_crispy_field}}                                                                           
                                                                            </div> 
                                                                            
                                                                            <a href="{% url 'SpareParts:SparePartsNameCreate' %}" style="width: 25%; " data-target="#action_modal" data-toggle="modal" class=" btn btn-success d-inline-block">
                                                                                   منتج جديد                                                                        
                                                                            </a>
                                        
                                                                    </th>
                                                                    <th class="col-lg-2 col-xl-2 col-md-2">{{form.product_quantity|as_crispy_field}} </th>
                                                                    <th class="col-lg-2 col-xl-2 col-md-2">{{form.product_price|as_crispy_field}}</th>
                                                                    {% if not op1 %}
                                                                    <th class="col-lg-2 col-xl-2 col-md-2">
                                                                        <button style="width: 100%" type="submit" class="btn btn-success">اضافة</button>
                                                                    </th>
                                                                    {% endif %}
                                                                </tr>
                                                                </form>
                                                            </thead>
                                                            <tbody class=" text-center" >

                                                                {% if product %}
                                                                {% for x in product  %}
                                                                <tr class="shadow  bg-white ">
                                                                    <td>{{x.id}}</td>
                                                                    <td>
                                                                        <h4 class="text-truncate font-size-14"><a href="#" class="text-dark">{{x.product_name}}</a></h4>

                                                                    </td>
                                                                    <td ><h4><i class="fas fa-copy fx-7"></i> {{x.product_quantity}}</h4></td>
                                                                    <td><h4><span class="badge badge-primary"> <i class='bx bx-dollar'></i>{{ x.product_price }}</span></h4></td>
                                                                    {% if not op1 %}
                                                                    <td>
                                                                        <div class="team">
                                                                            <a href="{% url 'SpareParts:SparePartsOrderAddProductUpdate' x.id x.product_order.id %}" class="team-member d-inline-block btn btn-info btn-sm" data-target="#action_modal" data-toggle="modal">
                                                                                <i class='bx bx-edit' ></i>
                                                                            </a>

                                                                            <a href="{% url 'SpareParts:SparePartsOrderAddProductDelete' x.id x.product_order.id  %}"  class="team-member d-inline-block btn btn-danger btn-sm" data-target="#action_modal" data-toggle="modal">
                                                                                <i class='bx bxs-trash' ></i>
                                                                            </a>
                                                                        </div>
                                                                    </td>
                                                                    {% endif %}

                                                                </tr>
                                                                {% endfor %}

                                                                {% endif %}



                                                            </tbody>
                                                        </table>
                                                    </div>

                                            </div>
                                        </div>

                                    </div>
                            </div>
                        </div>

                        <!-- اجمالي  -->
                        <div class="row">
                            <!-- القطع -->
                            <div class="col-lg-4 col-md-4">
                                       <div class="card mini-stats-wid">
                                           <div class="card-body">
                                               <div class="media">
                                                   <div class="media-body">
                                                       <p class="text-muted font-weight-bold">عدد الأصناف</p>
                                                       <h4 class="mb-0">{{count_product}} صنف</h4>
                                                   </div>

                                                   <div class="mini-stat-icon avatar-sm rounded-circle bg-primary align-self-center">
                                                       <span class="avatar-title">
                                                           <i class="bx bx-copy-alt bx-sm"></i>
                                                       </span>
                                                   </div>
                                               </div>
                                           </div>
                                       </div>
                                   </div>
                                 
                                <!-- الكمية -->
                               <div class="col-lg-4 col-md-4">
                                               <div class="card mini-stats-wid">
                                                   <div class="card-body">
                                                       <div class="media">
                                                           <div class="media-body">
                                                               <p class="text-muted font-weight-bold ">اجمالي الكمية </p>
                                                               <h4 class="mb-0">
                                                                   {% if qu %}
                                                                   {{qu}}
                                                                   {% else %}
                                                                   0
                                                                   {% endif %}
                                                                   قطعة
                                                               </h4>
                                                           </div>

                                                           <div class="mini-stat-icon avatar-sm rounded-circle bg-primary align-self-center">
                                                               <span class="avatar-title">
                                                                <i class="fas fa-balance-scale"></i>
                                                               </span>
                                                           </div>
                                                       </div>
                                                   </div>
                                               </div>
                               </div>
                               
                               <!-- المبلغ -->
                               <div class="col-lg-4 col-md-4">
                                               <div class="card mini-stats-wid">
                                                   <div class="card-body">
                                                       <div class="media">
                                                           <div class="media-body">
                                                               <p class="text-muted font-weight-bold ">اجمالي المبلغ </p>
                                                               <h4 class="mb-0">
                                                                   {% if total %}
                                                                   {{total}}
                                                                   {% else %}
                                                                   0
                                                                   {% endif %}
                                                                   جنية
                                                               </h4>
                                                           </div>

                                                           <div class="mini-stat-icon avatar-sm rounded-circle bg-primary align-self-center">
                                                               <span class="avatar-title">
                                                                   <i class='bx bx-dollar-circle bx-sm'  ></i>
                                                               </span>
                                                           </div>
                                                       </div>
                                                   </div>
                                               </div>
                               </div>
                       </div>


                    </div>
                    {% endif %}
                </div>



                {% if is_paginated %}
                {% include "components/paginator.html" %}
                {% endif %}

              

          </div>
      </div>
  </div>
{% endblock main %}


{% block js %}

<script>
    $(document).ready(function() {
        $('#product').select2();
    });
</script>

<!-- <script>
    
    function updateDiv()
    { 
        $( "#order_list" ).load(window.location.href + " #order_list" );
    }
 
</script> -->

{% endblock js %}